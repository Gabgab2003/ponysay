<html lang="en">
<head>
<title>Truncation - Ponysay</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Ponysay">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Inner-workings.html#Inner-workings" title="Inner workings">
<link rel="prev" href="Printing-in-TTY-with-KMS.html#Printing-in-TTY-with-KMS" title="Printing in TTY with KMS">
<link rel="next" href="Languages.html#Languages" title="Languages">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual is for ponysay
(version 2.9),

Copyright (C) 2012 Mattias AndrÃ©e

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections, with no Front-Cover Texts,
     and with no Back-Cover Texts. A copy of the license is included in
     the section entitled ``GNU Free Documentation License''.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Truncation"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Languages.html#Languages">Languages</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Printing-in-TTY-with-KMS.html#Printing-in-TTY-with-KMS">Printing in TTY with KMS</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Inner-workings.html#Inner-workings">Inner workings</a>
<hr>
</div>

<h3 class="section">10.5 Truncation</h3>

<p><a name="index-truncation-392"></a><a name="index-output-truncation-393"></a><a name="index-kms-394"></a><a name="index-kernel-mode-setting-395"></a>
Ponysay supports three type of output truncations, cutting away overflow on the right
and truncation the height by either keeping the bottom or keeping the top. By default
the latest is enabled under TTY, cutting away overflow on the right is always enabled
by default.

   <p>Truncating the height in TTY is required under Kernel Mode Setting (KMS) support to
keep the colours from being messed up when the ponies is moved in the screen during
print. Prior to version 2.0 this was done either by piping to <samp><span class="command">head</span></samp> (keeps
the top) or by piping to <samp><span class="command">tail</span></samp> (keeps the bottom.) <samp><span class="command">head</span></samp> and
<samp><span class="command">tail</span></samp> takes as argument the number of lines to keep at most.

   <p>The size of the terminal, measured in characters, is fetched from <samp><span class="command">stty size</span></samp>,
which returns <code>HEIGHT WIDTH</code>, and <samp><span class="command">cut</span></samp> it the used to get either the
height or the width. This requires only GNU Coreutils; earlier <samp><span class="command">tput rows</span></samp> and
<samp><span class="command">tput cols</span></samp> were used, this however required, the only de facto standard,
package <samp><span class="command">ncurses</span></samp>, some shells have environment variables for this.

   <p>Since version 2.1 truncation is done internally in the Python script, before that it
was done in a custom C program <samp><span class="command">truncater</span></samp>, that was installed to
<samp><span class="file">/usr/lib/ponysay/truncater</span></samp>. It recognised UTF-8 ANSI escape sequences,
including OSI P and CSI m, which is essential for the truncation to be correct. It
also expands tabs to every eighth column and resets the background colour when needed,
and writes ANSI escape sequences that are on the left side of the truncation. The
truncater stops CSI sequences on the first ASCII letter (<code>[a-zA-Z]</code>), but also
stops escape sequences after the first character after the initial escape if it is
not either <code>[</code> (CSI) or <code>]</code> (OSI). In the previous, C, program it supported
UTF-8 by assuming that bytes do not match <code>10xxxxxx</code> and only those bytes were
visible. This now fixed internally in Python, but has also been improved to exclude
combining characters from the set of visible characters. Another difference is that
the background colours are not reset, instead ANSI colours after the truncation point
are still printed.

   </body></html>

