<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This manual is for ponysay
(version 3.0.1).

Copyright (C) 2012, 2013 Mattias AndrÃ©e

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with no Front-Cover Texts, and with no Back-Cover
Texts. A copy of the license is included in the section entitled
"GNU Free Documentation License". -->
<!-- Created by GNU Texinfo 5.1, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Ponysay: Truncation</title>

<meta name="description" content="Ponysay: Truncation">
<meta name="keywords" content="Ponysay: Truncation">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-and-program-index.html#Concept-and-program-index" rel="index" title="Concept and program index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Inner-workings.html#Inner-workings" rel="up" title="Inner workings">
<link href="Languages.html#Languages" rel="next" title="Languages">
<link href="Printing-in-TTY-with-KMS.html#Printing-in-TTY-with-KMS" rel="previous" title="Printing in TTY with KMS">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


<link rel="stylesheet" type="text/css" href="../../info.css"></head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<a name="Truncation"></a>
<div class="header">
<p>
Next: <a href="Languages.html#Languages" accesskey="n" rel="next">Languages</a>, Previous: <a href="Printing-in-TTY-with-KMS.html#Printing-in-TTY-with-KMS" accesskey="p" rel="previous">Printing in TTY with KMS</a>, Up: <a href="Inner-workings.html#Inner-workings" accesskey="u" rel="up">Inner workings</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-and-program-index.html#Concept-and-program-index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Truncation-1"></a>
<h3 class="section">12.6 Truncation</h3>
<a name="index-truncation-1"></a>
<a name="index-output-truncation"></a>
<a name="index-KMS-6"></a>
<a name="index-kernel-mode-setting-4"></a>

<p>Ponysay supports three type of output truncations, cutting away overflow on the right
and truncation the height by either keeping the bottom or keeping the top. By default
the latest is enabled under TTY, cutting away overflow on the right is always enabled
by default.
</p>
<p>Truncating the height in TTY is required under Kernel Mode Setting (KMS) support to
keep the colours from being messed up when the ponies is moved in the screen during
print. Prior to version 2.0 this was done either by piping to <code>head</code> (keeps
the top) or by piping to <code>tail</code> (keeps the bottom.) <code>head</code> and
<code>tail</code> takes as argument the number of lines to keep at most.
</p>
<p>The size of the terminal, measured in characters, is fetched from <code>stty size</code>,
which returns <code>HEIGHT WIDTH</code>, and <code>cut</code> it the used to get either the
height or the width. This requires only GNU Coreutils; earlier <code>tput rows</code> and
<code>tput cols</code> were used, this however required, the only de facto standard,
package <code>ncurses</code>, some shells have environment variables for this.
</p>
<p>Since version 2.1 truncation is done internally in the Python script, before that it
was done in a custom C program <code>truncater</code>, that was installed to
<samp>/usr/lib/ponysay/truncater</samp>. It recognised UTF-8 ANSI escape sequences,
including OSI P and CSI m, which is essential for the truncation to be correct. It
also expands tabs to every eighth column and resets the background colour when needed,
and writes ANSI escape sequences that are on the left side of the truncation. The
truncater stops CSI sequences on the first ASCII letter (<code>[a-zA-Z]</code>), but also
stops escape sequences after the first character after the initial escape if it is
not either <code>[</code> (CSI) or <code>]</code> (OSI). In the previous, C, program it supported
UTF-8 by assuming that bytes do not match <code>10xxxxxx</code> and only those bytes were
visible. This now fixed internally in Python, but has also been improved to exclude
combining characters from the set of visible characters. Another difference is that
the background colours are not reset, instead ANSI colours after the truncation point
are still printed.
</p>

<hr>
<div class="header">
<p>
Next: <a href="Languages.html#Languages" accesskey="n" rel="next">Languages</a>, Previous: <a href="Printing-in-TTY-with-KMS.html#Printing-in-TTY-with-KMS" accesskey="p" rel="previous">Printing in TTY with KMS</a>, Up: <a href="Inner-workings.html#Inner-workings" accesskey="u" rel="up">Inner workings</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-and-program-index.html#Concept-and-program-index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
